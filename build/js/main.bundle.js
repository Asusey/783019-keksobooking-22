(()=>{"use strict";const e=e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},t=e=>"Escape"===e.key||"Esc"===e.key,r=document.querySelector("#success").content.querySelector(".success"),o=document.querySelector("#error").content.querySelector(".error"),n=document.querySelector("main"),a=r.cloneNode(!0),c=o.cloneNode(!0),l=()=>{a.remove(),document.removeEventListener("click",d),document.removeEventListener("keydown",i)},d=e=>{e.preventDefault(),l()},i=e=>{t(e)&&(e.preventDefault(),l())},s=()=>{c.remove(),document.removeEventListener("click",u),document.removeEventListener("keydown",p)},u=e=>{e.preventDefault(),s()},p=e=>{t(e)&&(e.preventDefault(),s())},m=document.querySelector("#card").content.querySelector(".popup"),f={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},y=35.6895,v=139.69171;let h=null,g=[];const _=window.L.icon({iconUrl:"./img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),S=window.L.marker({lat:y,lng:v},{draggable:!0,icon:_}),q=e=>{const t=(e=>{const t=[];return e.forEach((e=>{const r=m.cloneNode(!0);r.querySelector(".popup__title").textContent=e.offer.title,r.querySelector(".popup__text--address").textContent=e.offer.address,r.querySelector(".popup__text--price").textContent=e.offer.price+" ₽/ночь",r.querySelector(".popup__type").textContent=f[e.offer.type],r.querySelector(".popup__text--capacity").textContent=e.offer.rooms+" комнаты для "+e.offer.guests+" гостей",r.querySelector(".popup__text--time").textContent="Заезд после "+e.offer.checkin+", выезд до "+e.offer.checkout;const o=(e=>{const t=document.createDocumentFragment();return e.forEach((e=>{const r=document.createElement("li");r.classList.add("popup__feature",`popup__feature--${e}`),t.appendChild(r)})),t})(e.offer.features,r.querySelector(".popup__feature"));r.querySelector(".popup__features").innerHTML="",r.querySelector(".popup__features").appendChild(o),r.querySelector(".popup__description").textContent=e.offer.description;const n=((e,t)=>{const r=document.createDocumentFragment();return e.forEach((e=>{const o=t.cloneNode(!0);o.src=e,r.appendChild(o)})),r})(e.offer.photos,r.querySelector(".popup__photo"));r.querySelector(".popup__photos").innerHTML="",r.querySelector(".popup__photos").appendChild(n),r.querySelector(".popup__avatar").src=e.author.avatar,t.push(r)})),t})(e);e.forEach(((e,r)=>{const o=window.L.icon({iconUrl:"./img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});window.L.marker({lat:e.location.lat,lng:e.location.lng},{draggable:!1,icon:o,adPin:!0}).addTo(h).bindPopup(t[r])}))},b=()=>{L(),q(g.slice(0,10))},L=()=>{h.eachLayer((e=>{e.options.adPin&&e.remove()}))},E=["gif","jpg","jpeg","png"],w=document.querySelector(".ad-form__field .ad-form-header__input"),k=document.querySelector(".ad-form-header__preview"),C=document.querySelector(".ad-form-header__preview img"),A=document.querySelector(".ad-form__upload .ad-form__input"),x=document.querySelector(".ad-form__photo-container"),D=document.querySelector(".ad-form__photo");w.addEventListener("change",(()=>{const t=w.files[0],r=t.name.toLowerCase();if(E.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{C.src=e.result})),e.readAsDataURL(t)}else e("Пожалуйста, загрузите фото с расширением .jpeg или .png")})),A.addEventListener("change",(()=>{const e=A.files;Array.from(e).forEach((e=>{const t=e,r=t.name.toLowerCase();if(E.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{D.remove();const t=document.createElement("img"),r=document.createElement("div");t.src=e.result,t.alt="Фото жилья",t.width=70,t.height=70,r.classList.add("ad-form__photo"),r.appendChild(t),x.appendChild(r)})),e.readAsDataURL(t)}}))}));const F=()=>{document.querySelectorAll(".ad-form__photo").forEach(((e,t)=>{0===t?e.querySelector("img")&&e.querySelector("img").remove():e.remove()})),k.children[0].src="img/muffin-grey.svg"},T=document.querySelector(".map__filters"),V=T.querySelector("#housing-type"),$=T.querySelector("#housing-price"),j=T.querySelector("#housing-rooms"),z=T.querySelector("#housing-guests"),N=T.querySelectorAll(".map__checkbox"),P=()=>{T.reset()},R=document.querySelector(".ad-form"),U=document.querySelector("#title"),M=R.querySelector("#price"),H=R.querySelector("#room_number"),O=R.querySelector("#capacity"),W=R.elements,I=R.querySelectorAll("#capacity option"),B={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]},G=Array.from(W);G.forEach((e=>{e.addEventListener("invalid",(e=>{e.target.style.border="solid 3px red"})),e.addEventListener("input",(e=>{e.target.style.border="none"}))}));const J=document.querySelector(".ad-form"),K=J.querySelector("#type"),Q=J.querySelector("#price"),X=J.querySelector("#address"),Y=J.querySelector(".ad-form__element--time"),Z=J.querySelector("#timein"),ee=J.querySelector("#timeout"),te=J.querySelector(".ad-form__reset"),re={bungalow:0,flat:1e3,house:5e3,palace:1e4};K.addEventListener("change",(e=>{Q.placeholder=re[e.target.value],Q.setAttribute("min",re[e.target.value])})),Y.addEventListener("change",(e=>{ee.value=e.target.value,Z.value=e.target.value}));const oe=()=>{J.reset(),F(),P(),b(),G.forEach((e=>{e.style.border="none"})),Q.placeholder=re.flat,S.setLatLng({lat:y,lng:v}),X.value=`${y}, ${v}`};te.addEventListener("click",(e=>{e.preventDefault(),oe(),F(),P(),b()}));const ne=document.querySelector(".map__filters"),ae=ne.querySelectorAll(".map__filter"),ce=ne.querySelector(".map__features"),le=J.querySelector(".ad-form-header"),de=J.querySelectorAll(".ad-form__element"),ie=(e,t)=>{e.forEach((e=>{e.disabled=t}))};var se,ue;ne.classList.add("ad-form--disabled"),ie(ae,!0),ce.setAttribute("disabled","disabled"),J.classList.add("ad-form--disabled"),le.setAttribute("disabled","disabled"),ie(de,!0),X.setAttribute("readonly",""),U.addEventListener("input",(()=>{const e=U.value.length;e<30?U.setCustomValidity("Введите ещё "+(30-e)+" симв."):e>100?U.setCustomValidity("Удалите лишние "+(e-100)+" симв."):U.setCustomValidity(""),U.reportValidity()})),H.addEventListener("change",(e=>{const t=B[e.target.value];O.querySelectorAll("option").forEach((e=>{t.includes(e.value)?(e.removeAttribute("disabled"),O.value=e.value):e.setAttribute("disabled","disabled")}))})),se=()=>{n.appendChild(a),document.addEventListener("click",d),document.addEventListener("keydown",i)},ue=()=>{n.appendChild(c),document.addEventListener("click",u),document.addEventListener("keydown",p)},J.addEventListener("submit",(e=>{e.preventDefault(),(()=>{const e=Q.value,t=K.value;return re[t]<e?(M.setCustomValidity("Поле, обязательное для заполнения"),!1):(M.setCustomValidity(""),!0)})()&&((e,t,r)=>{fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:r}).then((r=>{r.ok?e():t()})).catch((()=>{t()}))})((()=>{se(),oe()}),(()=>ue()),new FormData(e.target))})),h=window.L.map("map-canvas").on("load",(()=>{ne.classList.remove("ad-form--disabled"),ie(ae,!1),ce.removeAttribute("disabled","disabled"),J.classList.remove("ad-form--disabled"),le.removeAttribute("disabled","disabled"),ie(de,!1),I.forEach((e=>{e.selected||e.setAttribute("disabled","disabled")})),X.value=`${y}, ${v}`})).setView({lat:y,lng:v},10),window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(h),S.addTo(h),S.on("moveend",(e=>{X.value=`${e.target.getLatLng().lat.toFixed(5)}, ${e.target.getLatLng().lng.toFixed(5)}`})),((e,t)=>{fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((t=>{e(t)})).catch((()=>{t("Данные сервера получены не в полном объёме")}))})((e=>{g=e,q(e.slice(0,10))}),e),T.addEventListener("change",window._.debounce((()=>{(e=>{L();const t=[];for(let r of g)if(e(r)&&t.push(r),t.length>=10)break;q(t)})((e=>(e=>V.value===e.offer.type||"any"===V.value)(e)&&(e=>"low"===$.value&&e.offer.price<1e4||"high"===$.value&&e.offer.price>5e4||"middle"===$.value&&e.offer.price>=1e4&&e.offer.price<=5e4||"any"===$.value)(e)&&(e=>j.value===e.offer.rooms.toString()||"any"===j.value)(e)&&(e=>z.value===e.offer.guests.toString()||"any"===z.value)(e)&&(e=>Array.from(N).filter((e=>e.checked)).every((t=>e.offer.features.includes(t.value))))(e)))}),500))})();
//# sourceMappingURL=main.bundle.js.map