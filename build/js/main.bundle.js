(()=>{"use strict";const e=e=>{const t=document.createElement("div");t.style.zIndex=100,t.style.position="absolute",t.style.left=0,t.style.top=0,t.style.right=0,t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="red",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},t=e=>"Escape"===e.key||"Esc"===e.key,r=document.querySelector("#success").content.querySelector(".success"),o=document.querySelector("#error").content.querySelector(".error"),a=document.querySelector("main"),n=r.cloneNode(!0),l=o.cloneNode(!0),d=()=>{n.remove(),document.removeEventListener("click",c),document.removeEventListener("keydown",i)},c=e=>{e.preventDefault(),d()},i=e=>{t(e)&&(e.preventDefault(),d())},s=()=>{l.remove(),document.removeEventListener("click",u),document.removeEventListener("keydown",p)},u=e=>{e.preventDefault(),s()},p=e=>{t(e)&&(e.preventDefault(),s())},m=document.querySelector("#card").content.querySelector(".popup"),y={flat:"Квартира",bungalow:"Бунгало",house:"Дом",palace:"Дворец"},f=35.6895,v=139.69171;let h=null,g=[];const _=window.L.icon({iconUrl:"./img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),S=window.L.marker({lat:f,lng:v},{draggable:!0,icon:_}),q=e=>{const t=(e=>{const t=[];return e.forEach((e=>{const r=m.cloneNode(!0);r.querySelector(".popup__title").textContent=e.offer.title,r.querySelector(".popup__text--address").textContent=e.offer.address,r.querySelector(".popup__text--price").textContent=e.offer.price+" ₽/ночь",r.querySelector(".popup__type").textContent=y[e.offer.type],r.querySelector(".popup__text--capacity").textContent=e.offer.rooms+" комнаты для "+e.offer.guests+" гостей",r.querySelector(".popup__text--time").textContent="Заезд после "+e.offer.checkin+", выезд до "+e.offer.checkout;const o=(e=>{const t=document.createDocumentFragment();return e.forEach((e=>{const r=document.createElement("li");r.classList.add("popup__feature",`popup__feature--${e}`),t.appendChild(r)})),t})(e.offer.features,r.querySelector(".popup__feature"));r.querySelector(".popup__features").innerHTML="",r.querySelector(".popup__features").appendChild(o),r.querySelector(".popup__description").textContent=e.offer.description;const a=((e,t)=>{const r=document.createDocumentFragment();return e.forEach((e=>{const o=t.cloneNode(!0);o.src=e,r.appendChild(o)})),r})(e.offer.photos,r.querySelector(".popup__photo"));r.querySelector(".popup__photos").innerHTML="",r.querySelector(".popup__photos").appendChild(a),r.querySelector(".popup__avatar").src=e.author.avatar,t.push(r)})),t})(e);e.forEach(((e,r)=>{const o=window.L.icon({iconUrl:"./img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]});window.L.marker({lat:e.location.lat,lng:e.location.lng},{draggable:!1,icon:o,adPin:!0}).addTo(h).bindPopup(t[r])}))},b=()=>{L(),q(g.slice(0,10))},L=()=>{h.eachLayer((e=>{e.options.adPin&&e.remove()}))},E=["gif","jpg","jpeg","png"],w=document.querySelector(".ad-form__field .ad-form-header__input"),k=document.querySelector(".ad-form-header__preview"),C=document.querySelector(".ad-form-header__preview img"),A=document.querySelector(".ad-form__upload .ad-form__input"),x=document.querySelector(".ad-form__photo-container"),D=document.querySelector(".ad-form__photo");w.addEventListener("change",(()=>{const t=w.files[0],r=t.name.toLowerCase();if(E.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{C.src=e.result})),e.readAsDataURL(t)}else e("Пожалуйста, загрузите фото с расширением .jpeg или .png")})),A.addEventListener("change",(()=>{const e=A.files;Array.from(e).forEach((e=>{const t=e,r=t.name.toLowerCase();if(E.some((e=>r.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{D.remove();const t=document.createElement("img"),r=document.createElement("div");t.src=e.result,t.alt="Фото жилья",t.width=70,t.height=70,r.classList.add("ad-form__photo"),r.appendChild(t),x.appendChild(r)})),e.readAsDataURL(t)}}))}));const V=()=>{document.querySelectorAll(".ad-form__photo").forEach(((e,t)=>{0===t?e.querySelector("img")&&e.querySelector("img").remove():e.remove()})),k.children[0].src="img/muffin-grey.svg"},$=document.querySelector(".map__filters"),F=$.querySelector("#housing-type"),T=$.querySelector("#housing-price"),j=$.querySelector("#housing-rooms"),z=$.querySelector("#housing-guests"),N=$.querySelectorAll(".map__checkbox"),P=()=>{$.reset()},R=document.querySelector(".ad-form"),U=document.querySelector("#title"),M=R.querySelector("#price"),H=R.querySelector("#room_number"),I=R.querySelector("#capacity"),O=R.elements,W=R.querySelectorAll("#capacity option"),B={1:["1"],2:["1","2"],3:["1","2","3"],100:["0"]},G=Array.from(O);G.forEach((e=>{e.addEventListener("invalid",(e=>{e.target.style.border="solid 3px red"})),e.addEventListener("input",(e=>{e.target.style.border="none"}))}));const J=document.querySelector(".ad-form"),K=J.querySelector("#type"),Q=J.querySelector("#address"),X=J.querySelector(".ad-form__element--time"),Y=J.querySelector("#timein"),Z=J.querySelector("#timeout"),ee=J.querySelector(".ad-form__reset"),te={bungalow:0,flat:1e3,house:5e3,palace:1e4},re=()=>{const e=M.value,t=K.value;return e||"bungalow"===t?parseInt(e,10)<te[t]?(M.setCustomValidity(`Цена не может быть ниже ${te[t]}`),!1):(M.setCustomValidity(""),!0):(M.setCustomValidity("Поле, обязательное для заполнения"),!1)};M.addEventListener("input",(()=>{re(),M.reportValidity()})),M.addEventListener("blur",(()=>{re(),M.reportValidity()})),K.addEventListener("change",(e=>{M.placeholder=te[e.target.value],M.setAttribute("min",te[e.target.value]),re(),M.reportValidity()})),X.addEventListener("change",(e=>{Z.value=e.target.value,Y.value=e.target.value}));const oe=()=>{J.reset(),V(),P(),b(),G.forEach((e=>{e.style.border="none"})),M.placeholder=te.flat,S.setLatLng({lat:f,lng:v}),Q.value=`${f}, ${v}`};ee.addEventListener("click",(e=>{e.preventDefault(),oe(),V(),P(),b()}));const ae=document.querySelector(".map__filters"),ne=ae.querySelectorAll(".map__filter"),le=ae.querySelector(".map__features"),de=J.querySelector(".ad-form-header"),ce=J.querySelectorAll(".ad-form__element"),ie=(e,t)=>{e.forEach((e=>{e.disabled=t}))};var se,ue;ae.classList.add("ad-form--disabled"),ie(ne,!0),le.setAttribute("disabled","disabled"),J.classList.add("ad-form--disabled"),de.setAttribute("disabled","disabled"),ie(ce,!0),Q.setAttribute("readonly",""),U.addEventListener("input",(()=>{const e=U.value.length;e<30?U.setCustomValidity("Введите ещё "+(30-e)+" симв."):e>100?U.setCustomValidity("Удалите лишние "+(e-100)+" симв."):U.setCustomValidity(""),U.reportValidity()})),H.addEventListener("change",(e=>{const t=B[e.target.value];I.querySelectorAll("option").forEach((e=>{t.includes(e.value)?(e.removeAttribute("disabled"),I.value=e.value):e.setAttribute("disabled","disabled")}))})),se=()=>{a.appendChild(n),document.addEventListener("click",c),document.addEventListener("keydown",i)},ue=()=>{a.appendChild(l),document.addEventListener("click",u),document.addEventListener("keydown",p)},J.addEventListener("submit",(e=>{e.preventDefault(),re()&&((e,t,r)=>{fetch("https://22.javascript.pages.academy/keksobooking",{method:"POST",body:r}).then((r=>{r.ok?e():t()})).catch((()=>{t()}))})((()=>{se(),oe()}),(()=>ue()),new FormData(e.target))})),h=window.L.map("map-canvas").on("load",(()=>{ae.classList.remove("ad-form--disabled"),ie(ne,!1),le.removeAttribute("disabled","disabled"),J.classList.remove("ad-form--disabled"),de.removeAttribute("disabled","disabled"),ie(ce,!1),W.forEach((e=>{e.selected||e.setAttribute("disabled","disabled")})),Q.value=`${f}, ${v}`})).setView({lat:f,lng:v},10),window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(h),S.addTo(h),S.on("moveend",(e=>{Q.value=`${e.target.getLatLng().lat.toFixed(5)}, ${e.target.getLatLng().lng.toFixed(5)}`})),((e,t)=>{fetch("https://22.javascript.pages.academy/keksobooking/data").then((e=>e.json())).then((t=>{e(t)})).catch((()=>{t("Данные сервера получены не в полном объёме")}))})((e=>{g=e,q(e.slice(0,10))}),e),$.addEventListener("change",window._.debounce((()=>{(e=>{L();const t=[];for(let r of g)if(e(r)&&t.push(r),t.length>=10)break;q(t)})((e=>(e=>F.value===e.offer.type||"any"===F.value)(e)&&(e=>"low"===T.value&&e.offer.price<1e4||"high"===T.value&&e.offer.price>5e4||"middle"===T.value&&e.offer.price>=1e4&&e.offer.price<=5e4||"any"===T.value)(e)&&(e=>j.value===e.offer.rooms.toString()||"any"===j.value)(e)&&(e=>z.value===e.offer.guests.toString()||"any"===z.value)(e)&&(e=>Array.from(N).filter((e=>e.checked)).every((t=>e.offer.features.includes(t.value))))(e)))}),500))})();
//# sourceMappingURL=main.bundle.js.map